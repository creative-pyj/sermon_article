<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cloudflare Tunnel x Workers: ãƒ‰ãƒ¡ã‚¤ãƒ³ä¸è¦ã®è‡ªå®…ã‚µãƒ¼ãƒãƒ¼ã‚¢ã‚¯ã‚»ã‚¹ã‚¬ã‚¤ãƒ‰</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Tailwind Config for Custom Colors -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'cf-orange': '#F48120',
                        'cf-bg': '#FAFAF9', // Warm neutral background
                        'cf-card': '#FFFFFF',
                        'cf-text': '#374151',
                        'cf-accent': '#d97706', // Muted orange
                        'worker-blue': '#3B82F6',
                        'tunnel-purple': '#8B5CF6'
                    }
                }
            }
        }
    </script>

    <style>
        /* Custom Styles for Chart Containers */
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 400px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 350px;
            }
        }
        
        /* Utility for flow lines in HTML architecture diagram */
        .flow-line {
            height: 2px;
            background-color: #CBD5E1;
            position: relative;
        }
        .flow-line::after {
            content: 'â–º';
            position: absolute;
            right: -6px;
            top: -8px;
            color: #CBD5E1;
            font-size: 12px;
        }

        body {
            background-color: #FAFAF9; /* Warm neutral */
            color: #374151;
            font-family: 'Segoe UI', 'Hiragino Sans', 'Hiragino Kaku Gothic ProN', sans-serif;
        }
        
        .nav-active {
            border-bottom: 2px solid #F48120;
            color: #F48120;
            font-weight: bold;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <!-- Header -->
    <header class="bg-white shadow-sm sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex">
                    <div class="flex-shrink-0 flex items-center">
                        <span class="text-2xl font-bold text-gray-800">CF<span class="text-cf-orange">Tunnel</span>Lab</span>
                    </div>
                    <div class="hidden sm:ml-6 sm:flex sm:space-x-8">
                        <button onclick="navTo('dashboard')" id="nav-dashboard" class="nav-btn nav-active inline-flex items-center px-1 pt-1 text-sm font-medium text-gray-900">
                            æ¦‚è¦ & ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£
                        </button>
                        <button onclick="navTo('setup')" id="nav-setup" class="nav-btn inline-flex items-center px-1 pt-1 text-sm font-medium text-gray-500 hover:text-gray-700">
                            æ§‹ç¯‰æ‰‹é † (Step-by-Step)
                        </button>
                        <button onclick="navTo('config')" id="nav-config" class="nav-btn inline-flex items-center px-1 pt-1 text-sm font-medium text-gray-500 hover:text-gray-700">
                            è¨­å®šã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼
                        </button>
                    </div>
                </div>
                <div class="flex items-center">
                    <span class="px-3 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800">Research Phase</span>
                </div>
            </div>
        </div>
        <!-- Mobile menu placeholder -->
        <div class="sm:hidden bg-white border-t border-gray-200 flex justify-around p-2">
            <button onclick="navTo('dashboard')" class="text-xs p-2">æ¦‚è¦</button>
            <button onclick="navTo('setup')" class="text-xs p-2">æ‰‹é †</button>
            <button onclick="navTo('config')" class="text-xs p-2">è¨­å®š</button>
        </div>
    </header>

    <!-- Main Content Area -->
    <main class="flex-grow max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 w-full">

        <!-- VIEW: DASHBOARD (Concept & Analysis) -->
        <div id="view-dashboard" class="space-y-8 animate-fade-in">
            
            <!-- Intro Text -->
            <div class="bg-white rounded-lg shadow p-6">
                <h2 class="text-xl font-bold text-gray-900 mb-4">5.2 Workers VPCã¨Service Bindingã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ</h2>
                <p class="text-gray-600 mb-4 leading-relaxed">
                    ç‹¬è‡ªãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’è³¼å…¥ãƒ»è¨­å®šã›ãšã«ã€Cloudflare Workersã®ç„¡æ–™ã‚µãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³ï¼ˆ<code>*.workers.dev</code>ï¼‰ã‚’å…¥ã‚Šå£ã¨ã—ã¦ã€
                    è‡ªå®…å†…ã®ã‚µãƒ¼ãƒãƒ¼ï¼ˆPrivate Networkï¼‰ã¸å®‰å…¨ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹æ‰‹æ³•ã®ãƒªã‚µãƒ¼ãƒçµæœã§ã™ã€‚
                    é€šå¸¸ã€Tunnelã‚’åˆ©ç”¨ã™ã‚‹ã«ã¯ç‹¬è‡ªãƒ‰ãƒ¡ã‚¤ãƒ³ãŒå¿…è¦ã§ã™ãŒã€Cloudflare Workersã‚’ãƒªãƒãƒ¼ã‚¹ãƒ—ãƒ­ã‚­ã‚·ã¨ã—ã¦æ©Ÿèƒ½ã•ã›ã‚‹ã“ã¨ã§ã€
                    <strong>ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¬ã‚¹ã§ã®è‡ªå®…ã‚µãƒ¼ãƒãƒ¼å…¬é–‹</strong>ã‚’å®Ÿç¾ã—ã¾ã™ã€‚
                </p>
                <div class="flex flex-wrap gap-2 mt-2">
                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-md text-sm font-medium bg-orange-100 text-orange-800">
                        ã‚³ã‚¹ãƒˆ: Â¥0 (Free Plan)
                    </span>
                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-md text-sm font-medium bg-purple-100 text-purple-800">
                        æŠ€è¡“: Workers + Tunnel
                    </span>
                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-md text-sm font-medium bg-blue-100 text-blue-800">
                        ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£: Private Network
                    </span>
                </div>
            </div>

            <!-- Architecture Interactive Diagram -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- Diagram Visual -->
                <div class="bg-white rounded-lg shadow p-6">
                    <h3 class="text-lg font-semibold mb-6 flex items-center">
                        <span class="bg-gray-200 rounded-full w-6 h-6 flex items-center justify-center text-xs mr-2">1</span>
                        ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£
                    </h3>
                    
                    <div class="flex flex-col items-center justify-center space-y-4 py-4 select-none">
                        <!-- User -->
                        <div class="w-full max-w-xs p-3 border-2 border-gray-300 rounded-lg text-center hover:border-blue-400 transition cursor-pointer" onclick="updateDetail('user')">
                            <div class="text-2xl mb-1">ğŸ‘¤</div>
                            <div class="font-bold">User (Browser)</div>
                            <div class="text-xs text-gray-500">Access: my-app.username.workers.dev</div>
                        </div>

                        <!-- Arrow -->
                        <div class="text-gray-400 text-2xl">â¬‡</div>

                        <!-- Cloudflare Edge -->
                        <div class="w-full p-4 border-2 border-orange-200 bg-orange-50 rounded-xl relative">
                            <div class="absolute -top-3 left-4 bg-cf-orange text-white text-xs px-2 py-1 rounded">Cloudflare Edge</div>
                            
                            <div class="space-y-4 mt-2">
                                <!-- Worker -->
                                <div class="p-3 bg-white border-2 border-worker-blue rounded-lg shadow-sm hover:shadow-md transition cursor-pointer" onclick="updateDetail('worker')">
                                    <div class="flex items-center justify-between">
                                        <div class="font-bold text-worker-blue">Workers</div>
                                        <span class="text-xs bg-blue-100 text-blue-800 px-2 rounded">Proxy Logic</span>
                                    </div>
                                    <div class="text-xs text-gray-500 mt-1">Request Handler & Auth</div>
                                </div>

                                <!-- Binding Line -->
                                <div class="h-4 border-l-2 border-dashed border-gray-400 mx-auto w-0"></div>

                                <!-- Private Network -->
                                <div class="p-3 bg-white border-2 border-tunnel-purple rounded-lg shadow-sm hover:shadow-md transition cursor-pointer" onclick="updateDetail('network')">
                                    <div class="flex items-center justify-between">
                                        <div class="font-bold text-tunnel-purple">Private Network</div>
                                        <span class="text-xs bg-purple-100 text-purple-800 px-2 rounded">Virtual Network</span>
                                    </div>
                                    <div class="text-xs text-gray-500 mt-1">Route: 192.168.1.0/24</div>
                                </div>
                            </div>
                        </div>

                        <!-- Arrow -->
                        <div class="text-gray-400 text-2xl">â¬‡</div>

                        <!-- Home Network -->
                        <div class="w-full p-4 border-2 border-gray-300 bg-gray-50 rounded-xl relative">
                            <div class="absolute -top-3 left-4 bg-gray-600 text-white text-xs px-2 py-1 rounded">Home / On-Premise</div>
                            
                            <div class="flex items-center justify-center space-x-4 mt-2">
                                <!-- Connector -->
                                <div class="p-3 bg-white border border-gray-300 rounded text-center w-1/2 cursor-pointer" onclick="updateDetail('connector')">
                                    <div class="text-xl">ğŸ”Œ</div>
                                    <div class="text-sm font-bold">cloudflared</div>
                                </div>
                                <!-- Server -->
                                <div class="p-3 bg-white border border-gray-300 rounded text-center w-1/2 cursor-pointer" onclick="updateDetail('server')">
                                    <div class="text-xl">ğŸ–¥ï¸</div>
                                    <div class="text-sm font-bold">Local Server</div>
                                    <div class="text-xs text-gray-500">192.168.1.50</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Detail Panel -->
                <div class="flex flex-col space-y-8">
                    <!-- Contextual Detail Box -->
                    <div class="bg-white rounded-lg shadow p-6 border-l-4 border-cf-orange h-full">
                        <h3 class="text-lg font-semibold mb-2" id="detail-title">ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®ãƒã‚¤ãƒ³ãƒˆ</h3>
                        <div id="detail-content" class="text-sm text-gray-600 space-y-4">
                            <p>å·¦ã®å›³ã®å„è¦ç´ ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ã€è©³ç´°ãªå½¹å‰²ã¨è¨­å®šã®ãƒã‚¤ãƒ³ãƒˆãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</p>
                            <p><strong>ã€Œ5.2 Workers VPCã€ã®æ ¸å¿ƒï¼š</strong><br>
                            é€šå¸¸ã®Tunnelè¨­å®šï¼ˆPublic Hostnameï¼‰ã‚’è¡Œã‚ãšã€Tunnelã‚’ã€ŒPrivate Networkã€ãƒ¢ãƒ¼ãƒ‰ã§å‹•ä½œã•ã›ã¾ã™ã€‚
                            Workersã‚¹ã‚¯ãƒªãƒ—ãƒˆã‹ã‚‰ã“ã®Private Networkå†…ã®IPã‚¢ãƒ‰ãƒ¬ã‚¹ï¼ˆä¾‹: 192.168.1.50ï¼‰ã¸ç›´æ¥ <code>fetch</code> ã‚’è¡Œã†ã“ã¨ã§ã€
                            å¤–éƒ¨ã«IPã‚’å…¬é–‹ã›ãšã«ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ã«ã—ã¾ã™ã€‚</p>
                        </div>
                    </div>

                    <!-- Comparison Chart -->
                    <div class="bg-white rounded-lg shadow p-6">
                        <h3 class="text-lg font-semibold mb-4">æ–¹å¼æ¯”è¼ƒ: Domainless vs Public Hostname</h3>
                        <div class="chart-container">
                            <canvas id="comparisonChart"></canvas>
                        </div>
                        <p class="text-xs text-center text-gray-500 mt-2">
                            Workersæ–¹å¼ã¯ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã¨æŸ”è»Ÿæ€§ãŒé«˜ã„åé¢ã€è¨­å®šã®è¤‡é›‘ã•ãŒè‹¥å¹²å¢—ã—ã¾ã™ã€‚
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- VIEW: SETUP GUIDE (Step-by-Step) -->
        <div id="view-setup" class="hidden space-y-8 animate-fade-in">
            <div class="bg-white rounded-lg shadow p-6">
                <h2 class="text-xl font-bold text-gray-900 mb-2">å®Ÿè£…ã‚¹ãƒ†ãƒƒãƒ—ã‚¬ã‚¤ãƒ‰</h2>
                <p class="text-gray-600 mb-6">è‡ªå®…ã‚µãƒ¼ãƒãƒ¼ã¸ã®æ¥ç¶šã‚’ç¢ºç«‹ã™ã‚‹ãŸã‚ã®å…·ä½“çš„ãªæ‰‹é †ã§ã™ã€‚ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆã¨ã—ã¦ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚</p>

                <div class="space-y-6">
                    <!-- Step 1 -->
                    <div class="border border-gray-200 rounded-lg overflow-hidden">
                        <button class="w-full px-6 py-4 bg-gray-50 flex items-center justify-between focus:outline-none" onclick="toggleStep('step1')">
                            <div class="flex items-center">
                                <span class="flex-shrink-0 w-8 h-8 flex items-center justify-center bg-cf-orange text-white rounded-full font-bold mr-4">1</span>
                                <h3 class="font-semibold text-gray-800">Cloudflared Tunnelã®ä½œæˆã¨å®Ÿè¡Œ</h3>
                            </div>
                            <span id="icon-step1" class="text-gray-400 transform transition-transform">â–¼</span>
                        </button>
                        <div id="content-step1" class="hidden px-6 py-4 bg-white border-t border-gray-100">
                            <p class="mb-4 text-sm text-gray-600">è‡ªå®…ã‚µãƒ¼ãƒãƒ¼ï¼ˆLinux/Mac/Windowsï¼‰ã§Tunnelã‚’ä½œæˆã—ã¾ã™ã€‚ãƒ‰ãƒ¡ã‚¤ãƒ³ã®å‰²ã‚Šå½“ã¦ã¯è¡Œã„ã¾ã›ã‚“ã€‚</p>
                            <div class="bg-gray-800 text-gray-200 p-4 rounded-md font-mono text-sm overflow-x-auto">
                                # 1. ãƒ­ã‚°ã‚¤ãƒ³<br>
                                cloudflared tunnel login<br><br>
                                # 2. ãƒˆãƒ³ãƒãƒ«ä½œæˆ (åå‰ã¯ä»»æ„: home-lab)<br>
                                cloudflared tunnel create home-lab<br><br>
                                # 3. Private Networkã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°è¨­å®š (é‡è¦)<br>
                                # è‡ªå®…LANã®ã‚µãƒ–ãƒãƒƒãƒˆã‚’æŒ‡å®šã—ã¾ã™<br>
                                cloudflared tunnel route ip add 192.168.1.0/24 home-lab
                            </div>
                        </div>
                    </div>

                    <!-- Step 2 -->
                    <div class="border border-gray-200 rounded-lg overflow-hidden">
                        <button class="w-full px-6 py-4 bg-gray-50 flex items-center justify-between focus:outline-none" onclick="toggleStep('step2')">
                            <div class="flex items-center">
                                <span class="flex-shrink-0 w-8 h-8 flex items-center justify-center bg-worker-blue text-white rounded-full font-bold mr-4">2</span>
                                <h3 class="font-semibold text-gray-800">Workersã®ä½œæˆã¨è¨­å®š</h3>
                            </div>
                            <span id="icon-step2" class="text-gray-400 transform transition-transform">â–¼</span>
                        </button>
                        <div id="content-step2" class="hidden px-6 py-4 bg-white border-t border-gray-100">
                            <p class="mb-4 text-sm text-gray-600">Wranglerï¼ˆCLIï¼‰ã¾ãŸã¯ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚’ä½¿ç”¨ã—ã¦Workerã‚’ä½œæˆã—ã¾ã™ã€‚<code>wrangler.toml</code>ã®è¨­å®šãŒé‡è¦ã§ã™ã€‚</p>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <h4 class="font-bold text-sm mb-2 text-gray-700">wrangler.toml è¨­å®š</h4>
                                    <pre class="bg-gray-100 p-3 rounded text-xs text-gray-800 overflow-x-auto">
name = "home-access-worker"
main = "src/index.js"
compatibility_date = "2023-10-02"

# å¿…é ˆ: Private Networkã¸ã®ã‚¢ã‚¯ã‚»ã‚¹è¨±å¯
node_compat = true # å¿…è¦ã«å¿œã˜ã¦

# é‡è¦: ã“ã“ã¯Cloudflare Dashboardã§
# "Settings" -> "Variables" ã§ã¯ãªã
# Settings -> Functions -> Private Network
# ã®ã‚ˆã†ãªè¨­å®šãŒå¿…è¦ã«ãªã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ãŒã€
# ç¾åœ¨ã¯Tunnel Routeã‚’è¨­å®šã—ã¦ã„ã‚Œã°
# Workerã‹ã‚‰ã¯fetchã§IPæŒ‡å®šå¯èƒ½ã§ã™ã€‚
                                    </pre>
                                </div>
                                <div>
                                    <h4 class="font-bold text-sm mb-2 text-gray-700">è§£èª¬</h4>
                                    <ul class="list-disc list-inside text-xs text-gray-600 space-y-2">
                                        <li>Workersã‹ã‚‰Private IP (192.168.x.x) ã¸ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã«ã¯ã€Tunnelå´ã§ãã®IPç¯„å›²ãŒAdvertiseã•ã‚Œã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚</li>
                                        <li>ã‚¢ã‚«ã‚¦ãƒ³ãƒˆè¨­å®šã§Workersã®"Private Network Access"ãŒæœ‰åŠ¹åŒ–ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Step 3 -->
                    <div class="border border-gray-200 rounded-lg overflow-hidden">
                        <button class="w-full px-6 py-4 bg-gray-50 flex items-center justify-between focus:outline-none" onclick="toggleStep('step3')">
                            <div class="flex items-center">
                                <span class="flex-shrink-0 w-8 h-8 flex items-center justify-center bg-green-500 text-white rounded-full font-bold mr-4">3</span>
                                <h3 class="font-semibold text-gray-800">Workerã‚³ãƒ¼ãƒ‰ã®å®Ÿè£… (Proxy Logic)</h3>
                            </div>
                            <span id="icon-step3" class="text-gray-400 transform transition-transform">â–¼</span>
                        </button>
                        <div id="content-step3" class="hidden px-6 py-4 bg-white border-t border-gray-100">
                            <p class="mb-4 text-sm text-gray-600">å¤–éƒ¨ã‹ã‚‰ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å—ã‘å–ã‚Šã€å†…éƒ¨IPã¸è»¢é€ã™ã‚‹ã‚³ãƒ¼ãƒ‰ã§ã™ã€‚</p>
                            <div class="bg-gray-800 text-gray-200 p-4 rounded-md font-mono text-sm overflow-x-auto">
                                export default {<br>
                                &nbsp;&nbsp;async fetch(request, env, ctx) {<br>
                                &nbsp;&nbsp;&nbsp;&nbsp;// ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã®å†…éƒ¨IP<br>
                                &nbsp;&nbsp;&nbsp;&nbsp;const PRIVATE_IP = "http://192.168.1.50:8080";<br><br>
                                &nbsp;&nbsp;&nbsp;&nbsp;// URLãƒ‘ã‚¹ã‚’ç¶­æŒã—ã¦è»¢é€<br>
                                &nbsp;&nbsp;&nbsp;&nbsp;const url = new URL(request.url);<br>
                                &nbsp;&nbsp;&nbsp;&nbsp;const targetUrl = PRIVATE_IP + url.pathname + url.search;<br><br>
                                &nbsp;&nbsp;&nbsp;&nbsp;// ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å†æ§‹ç¯‰<br>
                                &nbsp;&nbsp;&nbsp;&nbsp;const newRequest = new Request(targetUrl, {<br>
                                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;method: request.method,<br>
                                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;headers: request.headers,<br>
                                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;body: request.body<br>
                                &nbsp;&nbsp;&nbsp;&nbsp;});<br><br>
                                &nbsp;&nbsp;&nbsp;&nbsp;// Cloudflareå†…éƒ¨ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯çµŒç”±ã§fetch<br>
                                &nbsp;&nbsp;&nbsp;&nbsp;return fetch(newRequest);<br>
                                &nbsp;&nbsp;}<br>
                                };
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- VIEW: CONFIG GENERATOR -->
        <div id="view-config" class="hidden space-y-8 animate-fade-in">
            <div class="bg-white rounded-lg shadow p-6">
                <h2 class="text-xl font-bold text-gray-900 mb-4">è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼</h2>
                <p class="text-gray-600 mb-6">ç’°å¢ƒå¤‰æ•°ã‚’å…¥åŠ›ã—ã¦ã€å¿…è¦ãªè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã¨ã‚³ãƒãƒ³ãƒ‰ã‚’ç”Ÿæˆã—ã¾ã™ã€‚</p>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                    <!-- Inputs -->
                    <div class="space-y-4 bg-gray-50 p-4 rounded-lg">
                        <h3 class="font-bold text-gray-700">ç’°å¢ƒãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿</h3>
                        
                        <div>
                            <label class="block text-xs font-medium text-gray-700">Tunnel Name</label>
                            <input type="text" id="inp-tunnel-name" value="my-home-tunnel" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 text-sm focus:ring-cf-orange focus:border-cf-orange sm:text-sm">
                        </div>

                        <div>
                            <label class="block text-xs font-medium text-gray-700">Internal Server IP</label>
                            <input type="text" id="inp-server-ip" value="192.168.1.50" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 text-sm focus:ring-cf-orange focus:border-cf-orange sm:text-sm">
                        </div>

                        <div>
                            <label class="block text-xs font-medium text-gray-700">Internal Port</label>
                            <input type="text" id="inp-server-port" value="8080" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 text-sm focus:ring-cf-orange focus:border-cf-orange sm:text-sm">
                        </div>

                        <div>
                            <label class="block text-xs font-medium text-gray-700">Subnet CIDR</label>
                            <input type="text" id="inp-cidr" value="192.168.1.0/24" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 text-sm focus:ring-cf-orange focus:border-cf-orange sm:text-sm">
                        </div>

                        <button onclick="generateConfig()" class="w-full bg-cf-orange text-white py-2 px-4 rounded hover:bg-orange-600 transition text-sm font-bold">è¨­å®šã‚’æ›´æ–°</button>
                    </div>

                    <!-- Outputs -->
                    <div class="md:col-span-2 space-y-6">
                        
                        <!-- Terminal Commands -->
                        <div>
                            <div class="flex justify-between items-center mb-2">
                                <h4 class="font-bold text-sm text-gray-700">Step 1: Terminal Commands</h4>
                                <button onclick="copyToClipboard('out-cmd')" class="text-xs text-blue-500 hover:text-blue-700">Copy</button>
                            </div>
                            <pre id="out-cmd" class="bg-gray-800 text-green-400 p-4 rounded text-xs font-mono overflow-x-auto whitespace-pre-wrap"></pre>
                        </div>

                        <!-- Config.yml -->
                        <div>
                            <div class="flex justify-between items-center mb-2">
                                <h4 class="font-bold text-sm text-gray-700">Step 2: config.yml (cloudflared)</h4>
                                <button onclick="copyToClipboard('out-yml')" class="text-xs text-blue-500 hover:text-blue-700">Copy</button>
                            </div>
                            <pre id="out-yml" class="bg-gray-800 text-yellow-300 p-4 rounded text-xs font-mono overflow-x-auto whitespace-pre-wrap"></pre>
                        </div>

                        <!-- Worker Code -->
                        <div>
                            <div class="flex justify-between items-center mb-2">
                                <h4 class="font-bold text-sm text-gray-700">Step 3: worker.js (src/index.js)</h4>
                                <button onclick="copyToClipboard('out-js')" class="text-xs text-blue-500 hover:text-blue-700">Copy</button>
                            </div>
                            <pre id="out-js" class="bg-gray-800 text-blue-300 p-4 rounded text-xs font-mono overflow-x-auto whitespace-pre-wrap"></pre>
                        </div>

                    </div>
                </div>
            </div>
        </div>

    </main>

    <!-- Footer -->
    <footer class="bg-white border-t border-gray-200 mt-auto">
        <div class="max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8">
            <p class="text-center text-xs text-gray-500">
                Generated for Cloudflare Research Purposes. No external libraries required beyond CDN links.
                <br>
                <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
                <!-- Chosen Palette: Warm Neutral (FAFAF9) with Cloudflare Orange (F48120) and Technical Accents -->
            </p>
        </div>
    </footer>

    <!-- Application Structure Plan: 
         Structure: Single Page App with Tabbed Navigation (Dashboard, Setup, Config).
         Rationale: 
         - 'Dashboard' provides the mental model (Architecture) first, as understanding the 'No Domain' flow is complex.
         - 'Setup' breaks down the 5.2 methodology into linear steps for execution.
         - 'Config' provides actionable code generation to reduce syntax errors.
         - Visualization uses Chart.js for trade-off analysis and interactive HTML/CSS for architecture exploration.
    -->

    <!-- Visualization & Content Choices:
         1. Architecture Diagram: Interactive HTML/CSS Grid. Goal: Visualize the invisible path (Worker -> Tunnel). Interaction: Click components to see details.
         2. Comparison Chart: Radar Chart (Chart.js). Goal: Compare this method vs traditional VPN vs Public Hostname.
         3. Code Generator: JS Template Literals. Goal: Provide copy-paste ready code tailored to user's IP range.
    -->

    <script>
        // State Management
        const state = {
            currentView: 'dashboard',
            tunnelName: 'my-home-tunnel',
            serverIp: '192.168.1.50',
            serverPort: '8080',
            cidr: '192.168.1.0/24'
        };

        // Navigation Logic
        function navTo(viewId) {
            // Update UI State
            document.querySelectorAll('[id^="view-"]').forEach(el => el.classList.add('hidden'));
            document.getElementById(`view-${viewId}`).classList.remove('hidden');
            
            // Update Nav Styles
            document.querySelectorAll('.nav-btn').forEach(el => {
                el.classList.remove('nav-active', 'text-gray-900');
                el.classList.add('text-gray-500', 'border-transparent');
            });
            const activeBtn = document.getElementById(`nav-${viewId}`);
            if (activeBtn) {
                activeBtn.classList.add('nav-active', 'text-gray-900');
                activeBtn.classList.remove('text-gray-500', 'border-transparent');
            }
            
            state.currentView = viewId;
        }

        // Architecture Detail Logic
        const details = {
            'user': {
                title: 'User (Browser)',
                content: 'ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ <code>https://my-worker.subdomain.workers.dev</code> ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¾ã™ã€‚ã“ã‚Œã¯CloudflareãŒæä¾›ã™ã‚‹ç„¡æ–™ã®ãƒ‘ãƒ–ãƒªãƒƒã‚¯URLã§ã™ã€‚èªè¨¼æ©Ÿèƒ½ï¼ˆBasicèªè¨¼ã‚„Cloudflare Accessï¼‰ã‚’Workerã«å®Ÿè£…ã™ã‚‹ã“ã¨ã§ã€èª°ã§ã‚‚ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹çŠ¶æ…‹ã‚’é˜²ãã“ã¨ãŒã§ãã¾ã™ã€‚'
            },
            'worker': {
                title: 'Cloudflare Workers (The Gateway)',
                content: 'Workerã¯ãƒªãƒãƒ¼ã‚¹ãƒ—ãƒ­ã‚­ã‚·ã¨ã—ã¦æ©Ÿèƒ½ã—ã¾ã™ã€‚ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å—ã‘å–ã‚Šã€<code>fetch()</code> é–¢æ•°ã‚’ä½¿ç”¨ã—ã¦å†…éƒ¨IPï¼ˆ192.168.x.xï¼‰ã¸ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’è»¢é€ã—ã¾ã™ã€‚ã“ã®éš›ã€Workerã¯TunnelãŒã‚¢ãƒ‰ãƒã‚¿ã‚¤ã‚ºã—ã¦ã„ã‚‹Private Networkã¸ã®ãƒ«ãƒ¼ãƒˆã‚’èªè­˜ã—ã€é­”æ³•ã®ã‚ˆã†ã«æ¥ç¶šã—ã¾ã™ã€‚'
            },
            'network': {
                title: 'Private Network (Virtual)',
                content: 'Cloudflareã®Zero Trustãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å±¤ã§ã™ã€‚Cloudflaredã«ã‚ˆã£ã¦ã‚¢ãƒ‰ãƒã‚¿ã‚¤ã‚ºã•ã‚ŒãŸCIDRï¼ˆ192.168.1.0/24ãªã©ï¼‰ã¸ã®é€šä¿¡ã‚’ä¸­ç¶™ã—ã¾ã™ã€‚Workerã‹ã‚‰ã® <code>fetch</code> ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯ã“ã®å±¤ã‚’çµŒç”±ã—ã¦Tunnelã¸ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã•ã‚Œã¾ã™ã€‚'
            },
            'connector': {
                title: 'cloudflared (Connector)',
                content: 'è‡ªå®…ã‚µãƒ¼ãƒãƒ¼å†…ã§å‹•ä½œã™ã‚‹ãƒ‡ãƒ¼ãƒ¢ãƒ³ã§ã™ã€‚å¤–å‘ãã®ã‚³ãƒã‚¯ã‚·ãƒ§ãƒ³ï¼ˆOutbound-onlyï¼‰ã‚’ç¢ºç«‹ã™ã‚‹ãŸã‚ã€è‡ªå®…ãƒ«ãƒ¼ã‚¿ãƒ¼ã®ãƒãƒ¼ãƒˆé–‹æ”¾ã¯ä¸€åˆ‡ä¸è¦ã§ã™ã€‚<code>tunnel route ip add</code> ã‚³ãƒãƒ³ãƒ‰ã§ã€è‡ªåˆ†ãŒæ‹…å½“ã™ã‚‹IPç¯„å›²ã‚’Cloudflareã«é€šçŸ¥ã—ã¾ã™ã€‚'
            },
            'server': {
                title: 'Local Server',
                content: 'æœ€çµ‚çš„ãªç›®çš„åœ°ã§ã™ã€‚Webã‚µãƒ¼ãƒãƒ¼ã€SSHã€RDPãªã©ã€‚Workerã‹ã‚‰ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯ã€ã‚ãŸã‹ã‚‚ãƒ­ãƒ¼ã‚«ãƒ«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å†…ã‹ã‚‰æ¥ãŸã‹ã®ã‚ˆã†ã«ã“ã®ã‚µãƒ¼ãƒãƒ¼ã«åˆ°é”ã—ã¾ã™ã€‚'
            }
        };

        function updateDetail(key) {
            const data = details[key];
            document.getElementById('detail-title').innerText = data.title;
            document.getElementById('detail-content').innerHTML = data.content;
            
            // Highlight active box slightly
            // (Simple visual feedback handled by CSS hover, logic could expand here)
        }

        // Accordion Logic
        function toggleStep(stepId) {
            const content = document.getElementById(`content-${stepId}`);
            const icon = document.getElementById(`icon-${stepId}`);
            
            if (content.classList.contains('hidden')) {
                content.classList.remove('hidden');
                icon.style.transform = 'rotate(180deg)';
            } else {
                content.classList.add('hidden');
                icon.style.transform = 'rotate(0deg)';
            }
        }

        // Config Generation Logic
        function generateConfig() {
            state.tunnelName = document.getElementById('inp-tunnel-name').value;
            state.serverIp = document.getElementById('inp-server-ip').value;
            state.serverPort = document.getElementById('inp-server-port').value;
            state.cidr = document.getElementById('inp-cidr').value;

            // Generate Terminal Commands
            const cmdText = `
# 1. Login
cloudflared tunnel login

# 2. Create Tunnel
cloudflared tunnel create ${state.tunnelName}

# 3. Route Network (Critical!)
cloudflared tunnel route ip add ${state.cidr} ${state.tunnelName}

# 4. Run Tunnel
cloudflared tunnel run ${state.tunnelName}
`.trim();

            // Generate YAML
            const ymlText = `
tunnel: <UUID_WILL_BE_HERE>
credentials-file: /root/.cloudflared/<UUID>.json

warp-routing:
  enabled: true

# No ingress rules needed for Private Network routing usually,
# but a catch-all is good practice.
ingress:
  - service: http_status:404
`.trim();

            // Generate JS
            const jsText = `
export default {
  async fetch(request, env, ctx) {
    // Target Configuration
    const TARGET_IP = "${state.serverIp}";
    const TARGET_PORT = "${state.serverPort}";
    const PROTOCOL = "http"; // or https

    // Construct target URL
    const url = new URL(request.url);
    const targetUrl = \`\${PROTOCOL}://\${TARGET_IP}:\${TARGET_PORT}\${url.pathname}\${url.search}\`;

    // Security: Simple Basic Auth Example (Optional)
    // const auth = request.headers.get("Authorization");
    // if (!auth) return new Response("Unauthorized", { status: 401 });

    // Proxy Request
    try {
      const response = await fetch(targetUrl, {
        method: request.method,
        headers: request.headers,
        body: request.body
      });
      return response;
    } catch (e) {
      return new Response("Connection Failed: " + e.message, { status: 502 });
    }
  }
};
`.trim();

            document.getElementById('out-cmd').innerText = cmdText;
            document.getElementById('out-yml').innerText = ymlText;
            document.getElementById('out-js').innerText = jsText;
        }

        function copyToClipboard(elementId) {
            const text = document.getElementById(elementId).innerText;
            navigator.clipboard.writeText(text).then(() => {
                alert('ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ');
            });
        }

        // Initialize Chart
        function initChart() {
            const ctx = document.getElementById('comparisonChart').getContext('2d');
            new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: ['è¨­å®šã®å®¹æ˜“ã•', 'ã‚³ã‚¹ãƒˆ', 'ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£(ç§˜åŒ¿æ€§)', 'ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹', 'æŸ”è»Ÿæ€§(Authç­‰)'],
                    datasets: [{
                        label: 'Workers + Private Network (Domainless)',
                        data: [3, 5, 5, 4, 5],
                        backgroundColor: 'rgba(244, 129, 32, 0.2)',
                        borderColor: '#F48120',
                        pointBackgroundColor: '#F48120',
                    },
                    {
                        label: 'Standard Tunnel (Public Hostname)',
                        data: [5, 4, 3, 5, 3],
                        backgroundColor: 'rgba(59, 130, 246, 0.2)',
                        borderColor: '#3B82F6',
                        pointBackgroundColor: '#3B82F6',
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            angleLines: {
                                display: false
                            },
                            suggestedMin: 0,
                            suggestedMax: 5
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': ' + context.raw;
                                }
                            }
                        }
                    }
                }
            });
        }

        // Initialize
        window.addEventListener('DOMContentLoaded', () => {
            generateConfig(); // Pre-fill config
            initChart(); // Draw chart
            
            // Animation class helper
            const style = document.createElement('style');
            style.innerHTML = `
                .animate-fade-in { animation: fadeIn 0.5s ease-out; }
                @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
            `;
            document.head.appendChild(style);   
        });

    </script>
</body>
</html>